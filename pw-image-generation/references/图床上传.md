# 图片上传（图生图必需）

本地图片需先上传到图床获取 URL，才能用于图生图。

## 推荐图床

### sm.ms（推荐，永久存储，支持删除）

```bash
curl -s -X POST -F "smfile=@本地图片路径" https://sm.ms/api/v2/upload
```

返回 JSON，提取 `data.url` 字段获取直链，如 `https://s2.loli.net/xxxxx.png`

**优点**:
- 永久存储
- 支持删除（通过 delete hash）
- 稳定性高
- 无需注册即可使用

### freeimage.host（备选，永久存储）

```bash
curl -s -X POST -F "source=@本地图片路径" "https://freeimage.host/api/1/upload?key=6d207e02198a847aa98d0a2a901485a5"
```

返回 JSON，提取 `image.url` 字段获取直链，如 `https://iili.io/xxxxx.png`

### Litterbox（临时，1小时有效）

```bash
curl -s -F "reqtype=fileupload" -F "time=1h" -F "fileToUpload=@本地图片路径" https://litterbox.catbox.moe/resources/internals/api.php
```

> 注意：部分网络环境可能 SSL 连接失败

### Catbox（永久）

```bash
curl -s -F "reqtype=fileupload" -F "fileToUpload=@本地图片路径" https://catbox.moe/user/api.php
```

> 注意：部分网络环境可能 SSL 连接失败

## 图床对比

| 图床 | 有效期 | 稳定性 | 删除支持 | 备注 |
|-----|-------|-------|---------|------|
| sm.ms | 永久 | 高 | ✅ 支持 | **推荐首选** |
| freeimage.host | 永久 | 高 | ✅ 支持 | 备选 |
| litterbox | 1小时 | 中 | ❌ 自动删除 | 部分网络不可用 |
| catbox | 永久 | 中 | ⚠️ 需注册 | 部分网络不可用 |
| imgbb | 永久 | 高 | ⚠️ 需注册 | 需要 API Key |

## 使用方式

### 上传图片

```bash
node ~/.claude/skills/pw-image-generation/scripts/upload-image.js <图片路径>

# 示例
node ~/.claude/skills/pw-image-generation/scripts/upload-image.js ./template/图.001.png
```

**功能**:
- 优先上传到 sm.ms
- 如果失败，自动尝试 freeimage.host
- 返回图片 URL
- 自动保存删除链接到 `.upload-history.json`

### 管理上传的图片

**列出所有上传的图片**:
```bash
node ~/.claude/skills/pw-image-generation/scripts/delete-image.js list
```

**删除指定图片**:
```bash
# 先列出图片，查看索引
node ~/.claude/skills/pw-image-generation/scripts/delete-image.js list

# 删除索引为 0 的图片
node ~/.claude/skills/pw-image-generation/scripts/delete-image.js delete 0
```

**批量删除所有图片**:
```bash
node ~/.claude/skills/pw-image-generation/scripts/delete-image.js delete-all
```

### 在提示词中使用

上传后，将 URL 放在 prompt 开头：

```
https://iili.io/xxxxx.png 参考这张图片，生成类似风格的新图片
```

---

## 删除图床文件

### freeimage.host

**方法 1: 通过网页删除**
1. 访问图片 URL（如 `https://iili.io/xxxxx.png`）
2. 点击页面上的 "Delete" 按钮
3. 确认删除

**方法 2: 通过删除链接**
- 上传时返回的 JSON 中包含 `delete_url` 字段
- 访问该链接即可删除图片
- 建议保存删除链接以便后续管理

**注意**:
- 无需注册即可上传，但删除需要删除链接
- 建议保存上传返回的完整 JSON 响应

### Litterbox

- 1小时后自动删除，无需手动操作
- 无法提前删除

### Catbox

**通过 API 删除**:
```bash
curl -X POST -F "userhash=你的userhash" -F "files=文件名" https://catbox.moe/user/api.php
```

**注意**:
- 需要注册账号获取 userhash
- 匿名上传的文件无法删除

---

## 最佳实践

1. **临时测试**: 使用 Litterbox（1小时自动删除）
2. **正式使用**: 使用 freeimage.host，保存删除链接
3. **长期管理**: 使用 Catbox 或 imgbb，注册账号便于管理
4. **隐私保护**: 不要上传包含敏感信息的图片到公共图床

